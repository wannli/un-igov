{% extends "base.html" %}
{% set page_title = "Meetings" %}
{% block content %}
<div class="mb-4">
  <nav class="flex items-center gap-2 text-sm text-muted">
    <a href="{{ site.base_url }}index.html" class="hover:text-un-blue transition-colors">igov</a>
    <span>/</span>
    <span class="text-gray-700">GA</span>
    <span>/</span>
    <a href="{{ site.base_url }}ga/plenary/{{ session }}/meetings/index.html" class="text-gray-700 hover:text-un-blue transition-colors">Plenary</a>
    <span>/</span>
    <span class="text-gray-700">{{ session }}</span>
    <span>/</span>
    <span class="text-gray-900 font-medium">Meetings</span>
  </nav>
</div>

<div class="mb-6">
  <h1 class="text-3xl font-bold text-gray-900 tracking-tight">Meetings</h1>
</div>

<div class="sticky top-20 z-10 space-y-3 bg-white/95 pb-3 backdrop-blur">
  <div class="rounded-xl border border-gray-200 bg-white p-2 shadow-sm">
    <div class="flex flex-wrap items-center gap-1.5 md:grid md:grid-cols-2">
      <div class="flex flex-wrap items-center gap-1.5 md:block">
        <label class="hidden md:inline-flex items-center text-[11px] font-semibold uppercase tracking-wide text-gray-500">Type</label>
        <select id="meeting-type-filter" class="filter-pill inline-flex items-center h-6 whitespace-nowrap rounded-full border border-gray-200 px-3 py-0.5 text-[11px] font-medium text-gray-600 transition-colors hover:border-gray-300 hover:text-gray-900 bg-white cursor-pointer">
          <option value="all">All</option>
          <option value="formal">Formal meetings</option>
          <option value="informal">Informal meetings</option>
          <option value="consultations">Informal consultations</option>
        </select>
      </div>
    </div>
  </div>
</div>

<div class="space-y-4">
  {% set upcoming_meetings = [] %}
  {% set past_meetings = [] %}

  {% for meeting in meetings %}
    {% set meeting_date = meeting.MT_dateTimeScheduleStart[:10] %}
    {% if meeting_date >= current_date %}
      {% set upcoming_meetings = (upcoming_meetings.append(meeting), upcoming_meetings) %}
    {% else %}
      {% set past_meetings = (past_meetings.append(meeting), past_meetings) %}
    {% endif %}
  {% endfor %}

  {% if upcoming_meetings %}
    <h2 class="text-lg font-semibold text-gray-900 mt-8 mb-4">Upcoming meetings</h2>
    <div class="space-y-4" id="upcoming-meetings">
      {% for meeting in upcoming_meetings %}
        <article class="border border-gray-200 rounded-lg overflow-hidden hover:border-gray-300 transition-colors hover-lift" data-type="{{ meeting.MT_type | lower if meeting.MT_type else '' }}">
          <a href="{{ meeting | meeting_url }}" class="block">
          <div class="bg-gray-50 px-4 py-3 border-b border-gray-200">
            <div class="flex items-start justify-between gap-4">
              <div class="flex-1 min-w-0">
                <div class="flex items-center gap-3">
                  <span class="font-semibold text-gray-900">{{ meeting.MT_name or "Meeting" }}</span>
                  {% if meeting.MT_type %}
                    <span class="px-2 py-0.5 rounded text-xs font-medium bg-blue-100 text-blue-800">{{ meeting.MT_type }}</span>
                  {% endif %}
                </div>
                {% if meeting.MT_commentary %}
                  <div class="mt-2 text-sm text-gray-600 prose prose-sm max-w-none">
                    {{ meeting.MT_commentary | safe }}
                  </div>
                {% endif %}
              </div>
              <div class="flex flex-col items-end gap-1 text-sm text-gray-600 whitespace-nowrap flex-shrink-0">
                <span class="font-medium">{{ meeting.MT_dateTimeScheduleStart | datetime_format("%A, %d %B %Y") }}</span>
                <span>{{ meeting.MT_dateTimeScheduleStart[11:16] }} - {{ meeting.MT_dateTimeScheduleEnd[11:16] }}</span>
                {% if meeting.MT_room %}
                  <span class="text-muted">{{ meeting.MT_room }}</span>
                {% endif %}
              </div>
            </div>
          </div>
          {% if meeting.MT_segment %}
            <div class="border-t border-gray-200 px-4 py-3">
              <div class="space-y-3">
                {% for segment in meeting.MT_segment %}
                  <div class="border-l-2 border-un-blue pl-3">
                    {% if segment.MTS_agenda %}
                      {% for agenda in segment.MTS_agenda %}
                        <div class="mb-1">
                          <span class="text-[11px] font-semibold uppercase tracking-wide text-muted">Item {{ agenda.item }}</span>
                        </div>
                      {% endfor %}
                    {% endif %}
                    {% if segment.MTS_segmentTitle %}
                      <h3 class="text-sm font-medium text-gray-900">{{ segment.MTS_segmentTitle }}</h3>
                    {% endif %}
                  </div>
                {% endfor %}
              </div>
            </div>
          {% endif %}
          </a>
        </article>
      {% endfor %}
    </div>
  {% endif %}

  {% if past_meetings %}
    <h2 class="text-lg font-semibold text-gray-900 mt-10 mb-4">Past meetings</h2>
    <div class="space-y-3" id="past-meetings">
      {% for meeting in past_meetings %}
        <article class="border border-gray-200 rounded-lg overflow-hidden p-4 hover:border-gray-300 transition-colors" data-type="{{ meeting.MT_type | lower if meeting.MT_type else '' }}">
          <a href="{{ meeting | meeting_url }}" class="block">
          <div class="flex flex-col gap-2 sm:flex-row sm:items-start sm:justify-between">
            <div class="flex-1 min-w-0">
              <h3 class="font-medium text-gray-900">{{ meeting.MT_name or "Meeting" }}</h3>
              <p class="mt-1 text-sm text-muted">
                {% if meeting.MT_type %}{{ meeting.MT_type }}{% endif %}
                {% if meeting.MT_session %}Â· {{ meeting.MT_session }}{% endif %}
              </p>
              {% if meeting.MT_segment %}
                <div class="mt-2 space-y-1">
                  {% for segment in meeting.MT_segment[:3] %}
                    {% if segment.MTS_agenda %}
                      {% for agenda in segment.MTS_agenda %}
                        <p class="text-xs text-muted">Item {{ agenda.item }}: {{ agenda.title[:50] }}{% if agenda.title and agenda.title|length > 50 %}...{% endif %}</p>
                      {% endfor %}
                    {% endif %}
                  {% endfor %}
                  {% if meeting.MT_segment|length > 3 %}
                    <p class="text-xs text-muted">+ {{ meeting.MT_segment|length - 3 }} more items</p>
                  {% endif %}
                </div>
              {% endif %}
            </div>
            <div class="flex flex-col items-end gap-1 text-sm text-gray-600 whitespace-nowrap flex-shrink-0">
              <span>{{ meeting.MT_dateTimeScheduleStart | datetime_format("%A, %d %B %Y") }}</span>
              <span>{{ meeting.MT_dateTimeScheduleStart[11:16] }} - {{ meeting.MT_dateTimeScheduleEnd[11:16] }}</span>
            </div>
          </div>
          </a>
        </article>
      {% endfor %}
    </div>
  {% endif %}

  {% if not meetings %}
    <div class="border border-gray-200 rounded-lg bg-gray-50 p-12 text-center">
      <p class="text-muted">No meetings data available yet.</p>
    </div>
  {% endif %}
</div>
{% endblock %}
