{% extends "base.html" %}
{% from "macros.html" import breadcrumbs, page_header, badge %}
{% set page_title = meeting.MT_name or "Meeting" %}

{% block content %}
{{ breadcrumbs([
  {'label': 'Home', 'url': site.base_url ~ 'index.html'},
  {'label': 'Meetings', 'url': site.base_url ~ 'ga/plenary/' ~ session ~ '/meetings/index.html'},
  {'label': meeting.MT_name or 'Meeting'}
]) }}

<div class="page-header">
  <h1>{{ meeting.MT_name or "Meeting" }}</h1>
  {% if meeting.MT_type %}
    <div class="mt-2">{{ badge(meeting.MT_type, 'primary') }}</div>
  {% endif %}
</div>

<div class="meeting-layout">
  <aside class="meeting-sidebar">
    <div class="meta-card">
      <h3>Meeting Details</h3>
      <div class="meta-grid">
        <div class="meta-item">
          <span class="meta-label">Date</span>
          <span class="meta-value">{{ meeting.MT_dateTimeScheduleStart | datetime_format("%A, %d %B %Y") }}</span>
        </div>
        <div class="meta-item">
          <span class="meta-label">Time</span>
          <span class="meta-value">{{ meeting.MT_dateTimeScheduleStart[11:16] }} - {{ meeting.MT_dateTimeScheduleEnd[11:16] }}</span>
        </div>
        {% if meeting.MT_room %}
        <div class="meta-item">
          <span class="meta-label">Location</span>
          <span class="meta-value">{{ meeting.MT_room }}</span>
        </div>
        {% endif %}
        {% if meeting.MT_session %}
        <div class="meta-item">
          <span class="meta-label">Session</span>
          <span class="meta-value">{{ meeting.MT_session }}</span>
        </div>
        {% endif %}
      </div>
    </div>

    <div class="mt-6">
      <a href="https://igov.un.org/ga/plenary/{{ session }}/meeting/{{ meeting_id }}" target="_blank" rel="noopener" class="nav-card justify-center items-center">
        <div class="nav-card-icon">
          <svg class="icon icon-md"><use href="#icon-external"/></svg>
        </div>
        <div class="nav-card-content">
          <h3 class="nav-card-title">View on igov.un.org</h3>
          <p class="nav-card-description">Open the official meeting record</p>
        </div>
      </a>
    </div>
  </aside>

  <main>
    {% if meeting.MT_commentary %}
    <section class="mb-8">
      <h2 class="text-xl mb-3">Overview</h2>
      <div class="card">
        <div class="card-body">
          {{ meeting.MT_commentary | safe }}
        </div>
      </div>
    </section>
    {% endif %}

    {% if meeting.MT_segment or rendered_procedure_steps %}
    <section>
      <h2 class="text-xl mb-3">Proceedings</h2>
      <div class="proceedings-list">
        {% for segment in meeting.MT_segment | default([]) %}
          {% set segment_id = loop.index0 + 1 %}
          {% set segment_steps = steps_by_segment[segment_id] | selectattr("text") | list %}
          {% if segment_steps or segment.MTS_segmentTitle or segment.MTS_segmentInfo %}
            <details class="proceedings-segment" open>
              <summary class="proceedings-segment-title">
                {{ segment.MTS_segmentTitle or segment.MTS_segmentInfo or 'Agenda Item' }}
              </summary>
              <div class="proceedings-segment-content">
                {% for step in segment_steps %}
                <div class="proceedings-step">
                  <div class="proceedings-step-text">
                    {{ step.text | safe }}
                  </div>
                  {% if step.speakers %}
                  <div class="proceedings-step-speakers">
                    {% for speaker in step.speakers %}{{ speaker.name }}{% if not loop.last %}, {% endif %}{% endfor %}
                  </div>
                  {% endif %}
                </div>
                {% endfor %}
              </div>
            </details>
          {% endif %}
        {% endfor %}
      </div>
    </section>
    {% endif %}
  </main>
</div>
{% endblock %}
