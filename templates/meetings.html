{% extends "base.html" %}
{% set page_title = "Meetings" %}
{% set active_page = "meetings" %}
{% block content %}
<div class="sdg-banner">
  <div class="sdg-color sdg-1"></div>
  <div class="sdg-color sdg-2"></div>
  <div class="sdg-color sdg-3"></div>
  <div class="sdg-color sdg-4"></div>
  <div class="sdg-color sdg-5"></div>
  <div class="sdg-color sdg-6"></div>
  <div class="sdg-color sdg-7"></div>
  <div class="sdg-color sdg-8"></div>
  <div class="sdg-color sdg-9"></div>
  <div class="sdg-color sdg-10"></div>
  <div class="sdg-color sdg-11"></div>
  <div class="sdg-color sdg-12"></div>
  <div class="sdg-color sdg-13"></div>
  <div class="sdg-color sdg-14"></div>
  <div class="sdg-color sdg-15"></div>
  <div class="sdg-color sdg-16"></div>
  <div class="sdg-color sdg-17"></div>
</div>

<div class="breadcrumbs">
  <a href="{{ site.base_url }}index.html">Home</a>
  <span>/</span>
  <span>Meetings</span>
</div>

<div class="page-header">
  <h1>Meetings â€” {{ session }}th Session</h1>
  <p class="lead">Official meeting records and schedules</p>
</div>

<div class="filter-bar">
  <label class="filter-bar-label">Filter by:</label>
  <select id="meeting-type-filter">
    <option value="all">All Meeting Types</option>
    <option value="formal">Formal Meetings</option>
    <option value="informal">Informal Meetings</option>
    <option value="consultations">Informal Consultations</option>
  </select>
</div>

<div class="meeting-list">
  {% set upcoming_meetings = [] %}
  {% set past_meetings = [] %}

  {% for meeting in meetings %}
    {% set meeting_date = meeting.MT_dateTimeScheduleStart[:10] %}
    {% if meeting_date >= current_date %}
      {% set upcoming_meetings = (upcoming_meetings.append(meeting), upcoming_meetings) %}
    {% else %}
      {% set past_meetings = (past_meetings.append(meeting), past_meetings) %}
    {% endif %}
  {% endfor %}

  {% if upcoming_meetings %}
    <div class="section-header mt-4">
      <h2>Upcoming Meetings</h2>
    </div>
    <div class="card-list" id="upcoming-meetings">
      {% for meeting in upcoming_meetings %}
        <article class="card" data-type="{{ meeting.MT_type | lower if meeting.MT_type else '' }}">
          <a href="{{ meeting | meeting_url }}" class="card-link">
            <div class="card-body">
              <div class="card-header">
                <h3 class="card-title">{{ meeting.MT_name or "Meeting" }}</h3>
                {% if meeting.MT_type %}
                  <span class="badge">{{ meeting.MT_type }}</span>
                {% endif %}
              </div>
              {% if meeting.MT_commentary %}
                <p class="card-subtitle">{{ meeting.MT_commentary | safe }}</p>
              {% endif %}
              <div class="card-meta">
                <span class="card-meta-item">
                  <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                    <line x1="16" y1="2" x2="16" y2="6"/>
                    <line x1="8" y1="2" x2="8" y2="6"/>
                    <line x1="3" y1="10" x2="21" y2="10"/>
                  </svg>
                  {{ meeting.MT_dateTimeScheduleStart | datetime_format("%A, %d %B %Y") }}
                </span>
                <span class="card-meta-item">
                  <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="10"/>
                    <polyline points="12 6 12 12 16 14"/>
                  </svg>
                  {{ meeting.MT_dateTimeScheduleStart[11:16] }} - {{ meeting.MT_dateTimeScheduleEnd[11:16] }}
                </span>
                {% if meeting.MT_room %}
                  <span class="card-meta-item">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/>
                      <circle cx="12" cy="10" r="3"/>
                    </svg>
                    {{ meeting.MT_room }}
                  </span>
                {% endif %}
              </div>
              {% if meeting.MT_segment %}
                <div class="card-agenda">
                  {% for segment in meeting.MT_segment %}
                    <div class="agenda-item">
                      {% if segment.MTS_agenda %}
                        {% for agenda in segment.MTS_agenda %}
                          <span class="agenda-item-label">Item {{ agenda.item }}</span>
                        {% endfor %}
                      {% endif %}
                      {% if segment.MTS_segmentTitle %}
                        <span class="agenda-item-title">{{ segment.MTS_segmentTitle }}</span>
                      {% endif %}
                    </div>
                  {% endfor %}
                </div>
              {% endif %}
            </div>
          </a>
        </article>
      {% endfor %}
    </div>
  {% endif %}

  {% if past_meetings %}
    <div class="section-header mt-4">
      <h2>Past Meetings</h2>
    </div>
    <div class="card-list compact" id="past-meetings">
      {% for meeting in past_meetings %}
        <article class="card" data-type="{{ meeting.MT_type | lower if meeting.MT_type else '' }}">
          <a href="{{ meeting | meeting_url }}" class="card-link">
            <div class="card-body" style="padding: 16px 20px;">
              <div class="card-list-item" style="padding: 0; border: none; margin: 0;">
                <div class="card-list-main">
                  <h3 class="card-title">{{ meeting.MT_name or "Meeting" }}</h3>
                  <div class="card-list-meta">
                    {% if meeting.MT_type %}
                      <span class="badge badge-outline">{{ meeting.MT_type }}</span>
                    {% endif %}
                    {% if meeting.MT_session %}
                      <span>{{ meeting.MT_session }}</span>
                    {% endif %}
                  </div>
                  {% if meeting.MT_segment %}
                    <div class="card-agenda-inline" style="margin-top: 12px;">
                      {% for segment in meeting.MT_segment[:3] %}
                        {% if segment.MTS_agenda %}
                          {% for agenda in segment.MTS_agenda %}
                            <span class="agenda-ref">Item {{ agenda.item }}: {{ agenda.title[:40] }}{% if agenda.title and agenda.title|length > 40 %}...{% endif %}</span>
                          {% endfor %}
                        {% endif %}
                      {% endfor %}
                      {% if meeting.MT_segment|length > 3 %}
                        <span class="agenda-more">+ {{ meeting.MT_segment|length - 3 }} more</span>
                      {% endif %}
                    </div>
                  {% endif %}
                </div>
                <div class="card-list-date">
                  <span>{{ meeting.MT_dateTimeScheduleStart | datetime_format("%d %b %Y") }}</span>
                  <span class="time">{{ meeting.MT_dateTimeScheduleStart[11:16] }}</span>
                </div>
              </div>
            </div>
          </a>
        </article>
      {% endfor %}
    </div>
  {% endif %}

  {% if not meetings %}
    <div class="empty-state">
      <p>No meetings data available yet.</p>
    </div>
  {% endif %}
</div>
{% endblock %}
